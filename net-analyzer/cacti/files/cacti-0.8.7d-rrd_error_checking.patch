Index: cacti/branches/main/docs/CHANGELOG
===================================================================
--- cacti/branches/main/docs/CHANGELOG	(revision 4870)
+++ cacti/branches/main/docs/CHANGELOG	(revision 4871)
@@ -69,7 +69,8 @@
 -bug#0001320: Invalid PHP_SELF Path
 -bug#0001326: If a user's password contains a single quote the login fails
 -bug#0001342: VRULE printed as HRULE on graph_templates.php graph template item list
--bug#0001351: Deleting 1000 graphs along with their Data Sources crashes the Server  
+-bug#0001351: Deleting 1000 graphs along with their Data Sources crashes the Server
+-bug#0001359: Better error checking in rrd.php  
 -bug: IE generates errors on both the host and graph settings pages
 -feature: Pagainate Treeview Dual Pane
 -feature: Allow user to specify maximum graphs per page from Treeview Dual Pane
Index: cacti/branches/main/lib/rrd.php
===================================================================
--- cacti/branches/main/lib/rrd.php	(revision 4870)
+++ cacti/branches/main/lib/rrd.php	(revision 4871)
@@ -95,6 +95,9 @@
 		if (sizeof($rrd_struc) == 0) {
 			session_write_close();
 			$fp = popen(read_config_option("path_rrdtool") . escape_command(" $command_line"), "r");
+			if (!$fp) {
+				unset($fp);
+			}
 		}else{
 			$i = 0;
 
@@ -129,6 +132,9 @@
 		if (sizeof($rrd_struc) == 0) {
 			session_write_close();
 			$fp = popen(read_config_option("path_rrdtool") . escape_command(" $command_line"), "rb");
+			if (!$fp) {
+				unset($fp);
+			}
 		}else{
 			$i = 0;
 
